<!DOCTYPE html>
<html ng-app="myApp">
<head>
    <meta charset="utf-8">
    <script src="../bower_components/angular/angular.js"></script>
    <script>
        angular
                .module('myApp', [])
                .controller('FilmController', FilmController)
                .service('getDataService', function($http) {
                    this.getData = function() {
                        return $http.get('Test.json')
                    }
                });

        FilmController.$inject = ['$scope','getDataService', '$window'];

        function FilmController($scope, getDataService, $window) {

            $scope.fromLocalStorage = JSON.parse($window.localStorage.getItem('jsonData'));

            //alert($scope.fromLocalStorage);
            if($scope.fromLocalStorage !== null && $scope.fromLocalStorage !== undefined){
                angular.forEach($scope.fromLocalStorage.users, function (value, key) {
                    if (key === 'vikram') {
                        $scope.vicky = value;
                        //alert(value);
                        var count = 0;
                        for(var i=0; i < value.length; i++){
                            //alert(value[i])
                          if(value[i].Cuisine === 'Italian'){
                               for(var j=0; j <  value[i].Dishes.length; j++) {
                                   if (value[i].Dishes[j].Status === 'Completed') {
                                       count++;
                                   }

                               }
                              value[i].Status = count*50;
                          }
                        }
                        $window.localStorage.clear('jsonData');
                        var dataUpdate = JSON.stringify($scope.fromLocalStorage);
                        $window.localStorage.setItem('jsonData', dataUpdate);

                        $window.localStorage.setItem('Countfor'+'Italian'+'vikram', count);
                        alert(count);
                        alert("from local storage!!")
                        //$window.localStorage.clear();

                    }
                });
            }else {
                getDataService
                        .getData().then(function (data) {
                            $scope.test = data.data;
                            angular.
                                    forEach($scope.test.users, function (value, key) {
                                        if (key === 'vikram') {
                                            $scope.vicky = value;
                                            var dataToStore = JSON.stringify($scope.test);
                                            $window.localStorage.clear();
                                            $window.localStorage.setItem('jsonData', dataToStore);
                                            $window.document.cookie = dataToStore;
                                            alert("from json file!!")
                                            alert(dataToStore);
                                        }
                                    });
                        });

            }

        }

    </script>
</head>
<body>
<div ng-controller="FilmController">
    <ul>
        <li ng-repeat="film in vicky">
            {{ film.Status }}
        </li>
    </ul>
</div>
</body>
</html>